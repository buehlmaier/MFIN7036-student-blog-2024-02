<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="MFIN7036 Students 2024" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Group Next Level Pro, Progress Report 3, " />

<meta property="og:title" content="Sentiment Analysis &amp; Automatic Hyperparameter Optimization (by Group Next Level Pro) "/>
<meta property="og:url" content="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/sentiment-analysis-automatic-hyperparameter-optimization-by-group-next-level-pro.html" />
<meta property="og:description" content="During the presentation, due to time limitations, we could not fully share how the sentiment analysis and the tuning of the machine learning model were done. Therefore, we would like to provide a more detailed description of these two items in this blog post. Note: If you wish to run …" />
<meta property="og:site_name" content="MFIN7036 Student Blog 2024" />
<meta property="og:article:author" content="MFIN7036 Students 2024" />
<meta property="og:article:published_time" content="2024-03-19T00:00:00+08:00" />
<meta name="twitter:title" content="Sentiment Analysis &amp; Automatic Hyperparameter Optimization (by Group Next Level Pro) ">
<meta name="twitter:description" content="During the presentation, due to time limitations, we could not fully share how the sentiment analysis and the tuning of the machine learning model were done. Therefore, we would like to provide a more detailed description of these two items in this blog post. Note: If you wish to run …">

        <title>Sentiment Analysis &amp; Automatic Hyperparameter Optimization (by Group Next Level Pro)  · MFIN7036 Student Blog 2024
</title>
        <link href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="MFIN7036 Student Blog 2024 - Full Atom Feed" />



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/"><span class=site-name>MFIN7036 Student Blog 2024</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://buehlmaier.github.io/MFIN7036-student-blog-2024-02
                                    >Home</a>
                                </li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/categories.html">Categories</a></li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/tags.html">Tags</a></li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/sentiment-analysis-automatic-hyperparameter-optimization-by-group-next-level-pro.html">
                Sentiment Analysis & Automatic Hyperparameter Optimization (by Group Next Level Pro)
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>During the presentation, due to time limitations, we could not fully share how the sentiment analysis and the tuning of the machine learning model were done. Therefore, we would like to provide a more detailed description of these two items in this blog post.</p>
<p><em>Note: If you wish to run the sample code in this post, make sure to install and import the required packages.</em></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">graphviz</span> <span class="kn">import</span> <span class="n">Digraph</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">NewsSentiment</span> <span class="kn">import</span> <span class="n">TargetSentimentClassifier</span>
<span class="n">tsc</span> <span class="o">=</span> <span class="n">TargetSentimentClassifier</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">sent_tokenize</span> <span class="c1">#covered in our content, but not used in the code</span>
<span class="kn">from</span> <span class="nn">textblob</span> <span class="kn">import</span> <span class="n">TextBlob</span>
<span class="kn">from</span> <span class="nn">statistics</span> <span class="kn">import</span> <span class="n">mean</span> 
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">optuna</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
</code></pre></div>

<h1>1. Sentiment Analysis</h1>
<p>Our analysis consists of mainly two parts:
+ Computing the average sentiment from articles for every day in range
+ Computing the lagged effect of the average sentiments for every day in range</p>
<h2>1.1. Average Sentiment from articles on the same day</h2>
<p><em>Use this code to reproduce the graph locally:</em></p>
<div class="highlight"><pre><span></span><code><span class="n">dot</span> <span class="o">=</span> <span class="n">Digraph</span><span class="p">()</span>
<span class="c1"># Create nodes</span>
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;Raw text data on a centain day&#39;</span><span class="p">)</span> 
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;Filtered data&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;Tokenized data&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;BG&#39;</span><span class="p">,</span> <span class="s1">&#39;Background&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;TAR&#39;</span><span class="p">,</span> <span class="s1">&#39;Target&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;BG_P&#39;</span><span class="p">,</span> <span class="s1">&#39;Background Polarity&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;TAR_S&#39;</span><span class="p">,</span> <span class="s1">&#39;Target Sentiment&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;TAR_P&#39;</span><span class="p">,</span> <span class="s1">&#39;Target Polarity&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;TOT_P&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Polarity of the day&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;AVG_P&#39;</span><span class="p">,</span> <span class="s1">&#39;Average Polarity of articles on that day&#39;</span><span class="p">)</span>
<span class="c1"># Add edges</span>
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Filter out articles containing</span><span class="se">\n\t</span><span class="s1"> </span><span class="se">\&#39;</span><span class="s1">NVDA</span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">NVIDIA</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">Nvidia</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Sentence Tokenization&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;BG&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Sentences without </span><span class="se">\n\t</span><span class="s1"> </span><span class="se">\&#39;</span><span class="s1">NVDA</span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">NVIDIA</span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">Nvidia</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;TAR&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Sentences with </span><span class="se">\n\t</span><span class="s1"> </span><span class="se">\&#39;</span><span class="s1">NVDA</span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">NVIDIA</span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">Nvidia</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;BG&#39;</span><span class="p">,</span> <span class="s1">&#39;BG_P&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Average Polarity Score </span><span class="se">\n</span><span class="s1">using &quot;TextBlob&quot;&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;TAR&#39;</span><span class="p">,</span> <span class="s1">&#39;TAR_S&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> Probabilities of Positivity </span><span class="se">\n\t</span><span class="s1">of each sentence using &quot;NewsSentiment&quot;&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;TAR_S&#39;</span><span class="p">,</span> <span class="s1">&#39;TAR_P&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> Conversion from Probabilities to Polarity&#39;</span><span class="p">)</span>
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;BG_P&#39;</span><span class="p">,</span> <span class="s1">&#39;TOT_P&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> Weight=0.2&#39;</span><span class="p">)</span> 
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;TAR_P&#39;</span><span class="p">,</span> <span class="s1">&#39;TOT_P&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> Weight=0.8&#39;</span><span class="p">)</span> 
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;TOT_P&#39;</span><span class="p">,</span> <span class="s1">&#39;AVG_P&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> Divide by the number of articles in </span><span class="se">\&quot;</span><span class="s1">Filtered data</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;AVG_P&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> no. of articles&#39;</span><span class="p">)</span>
<span class="n">dot</span>
</code></pre></div>

<p><img alt="Figure 1" src="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/images/NextLevelPro_03_01Sentimentflow.png"></p>
<p>Our sentiment analysis for this part is illustrated in the graph.</p>
<h5>1. Filtering</h5>
<p>Basically, after web scraping, we ordered all the articles by date. From this, we filter out those that contain <code>NVDA</code>, <code>NVIDIA</code> or <code>Nvidia</code> (target) only, and discard all other irrelevant articles.</p>
<h5>2. Sentence Tokenization</h5>
<p>After that, we would perform sentence tokenization for each article using the <code>nltk</code> package. Then we can separate the sentences that mentioned the target and those that did not.</p>
<p>At this step, we would also check if the sentences contain weird symbols/hyperlinks or other things that may affect the sentiment analysis. If there is, we would remove them by means of string manipulation or regex.</p>
<h5>3. Sentiment for sentences not mentioning the target</h5>
<p>For those sentences that did not mention the target, we use <code>Textblob</code> to obtain an overall polarity of those sentences. Since the article itself contains the target, these sentences are still considered useful, but we will assign a lower weight of <strong>0.2</strong> to this polarity, and we will combine this with another score later.</p>
<h5>4. Sentiment for sentences mentioning the target</h5>
<p>For those sentences that mentioned the target, we instead use <code>NewsSentiment</code> to analyze the inferred positivity of the sentence to the target, as this package can better identify the positivity towards a specific noun in the sentence. The output of the <code>NewsSentiment</code> is actually a dictionary with 3 elements, which are <code>positive</code>, <code>negative</code>, and <code>neutral</code>. </p>
<p>For example, if the sentence is "I love NLP." and the target is set as "NLP", the output may be something like: {'positive': 0.9, 'negative': 0.05, 'neutral': 0.05}. </p>
<p>From this, we assign a weight of (1,0,-1) to positive, neutral and negative respectively, and then we can obtain the polarity of the sentence towards the target in general. For our example, the output would be 0.9*1+0.05*0+0.05*-1=<strong>0.85</strong></p>
<p>Using this method, we can obtain the score for every sentence that mentioned our target, then we average out the sentinments, and assign a weight of <strong>0.8</strong> to it.</p>
<h5>5. Combining sentiments for the day</h5>
<p>Using the results from <strong>Step 3 &amp; 4</strong>, we can then add up scores from every articles published on the same day, and divide by the number of articles. This gives us the average polarity of articles on that day.</p>
<h3>Code Extract of daily sentiment analysis</h3>
<p>Here, we provide an extract of our code for analyzing articles.</p>
<h4>1. Function for removing links</h4>
<p>In the data of Reuters, the tokenized sentences consist of html tags which represent hyperlinks. We then defined our own function to handle them in one go.</p>
<p><img alt="Figure 2" src="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/images/NextLevelPro_03_02beforeremovelink.png"></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">remove_link</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)):</span>
        <span class="n">links</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;&lt;a href.*?&gt;\([A-Z]</span><span class="si">{4}</span><span class="s2">.O\)&quot;</span><span class="p">,</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">links</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
                <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">link</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tokens</span>
<span class="n">remove_link</span><span class="p">(</span><span class="n">token_row0</span><span class="p">)</span>
</code></pre></div>

<p><img alt="Figure 3" src="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/images/NextLevelPro_03_03afterremovelink.png"></p>
<h4>2. Function for handling the sentiment calculation</h4>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">tokensentiment</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="n">withoutN</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#sentences without Nvidia using Textblob</span>
    <span class="n">withN</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#sentences with Nvidia using NewsSentiment</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Nvidia&quot;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;NVDA&quot;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;NVIDIA&quot;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">withoutN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TextBlob</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sentiment</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mod_text</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Nvidia&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;Nvidia&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Nvidia&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NVIDIA&quot;</span><span class="p">,</span> <span class="s2">&quot;Nvidia&quot;</span><span class="p">)</span>
            <span class="n">s</span><span class="o">=</span><span class="n">mod_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Nvidia&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sentiment</span> <span class="o">=</span> <span class="n">tsc</span><span class="o">.</span><span class="n">infer_from_text</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;Nvidia&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">pos</span><span class="p">,</span><span class="n">neg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">sentiment</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;class_label&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;positive&quot;</span><span class="p">:</span>
                        <span class="n">pos</span><span class="o">=</span><span class="n">j</span><span class="p">[</span><span class="s1">&#39;class_prob&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;class_label&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;negative&quot;</span><span class="p">:</span>
                        <span class="n">neg</span><span class="o">=</span><span class="n">j</span><span class="p">[</span><span class="s1">&#39;class_prob&#39;</span><span class="p">]</span>
                <span class="n">withN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="o">-</span><span class="n">neg</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="n">withN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TextBlob</span><span class="p">(</span><span class="n">mod_text</span><span class="p">)</span><span class="o">.</span><span class="n">sentiment</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#Use Textblob for edge cases</span>
    <span class="k">if</span> <span class="n">withoutN</span> <span class="ow">and</span> <span class="n">withN</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">(</span><span class="n">withoutN</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span><span class="o">+</span><span class="n">mean</span><span class="p">(</span><span class="n">withN</span><span class="p">)</span><span class="o">*</span><span class="mf">0.8</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">withN</span><span class="p">:</span> <span class="k">return</span> <span class="n">mean</span><span class="p">(</span><span class="n">withoutN</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>    <span class="k">return</span> <span class="n">mean</span><span class="p">(</span><span class="n">withN</span><span class="p">)</span>
</code></pre></div>

<p>This code handles Steps 3 &amp; 4 of the below workflow.</p>
<h2>1.2. Lagged effect for the Sentiment scores</h2>
<p>Since news would have a lagged effect on the stock. We then introduce an exponential weight decay approach to compute the final sentiment score of each day. We designed each new article would fade out in 15 days, a plot of the function is as below:</p>
<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Define the function</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">15</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y = (x - 15)^2 / 15^2&#39;</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Exponential decay function&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="Figure 4" src="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/images/NextLevelPro_03_04decayfunction.png"></p>
<p>Using this decay function, we can then compute the effect of articles across multiple days. In the following example, we denote the Average Polarity of articles on day X as PX and the function of weight decay as f(Day after news is published)\
[Note: the first day is day 0].</p>
<p>Let's say on Day 1, we have some articles which give us P1, then on Day 2 we have P2, and on Day 3 we have P3. </p>
<p><em>Use this code to reproduct the graph locally:</em></p>
<div class="highlight"><pre><span></span><code><span class="c1">#Compute the final sentiment score of a day</span>
<span class="n">FS</span> <span class="o">=</span> <span class="n">Digraph</span><span class="p">()</span>
<span class="c1">#Create nodes</span>
<span class="n">FS</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;P1&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;P2&#39;</span><span class="p">,</span> <span class="s1">&#39;P2&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;P3&#39;</span><span class="p">,</span> <span class="s1">&#39;P3&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;D1&#39;</span><span class="p">,</span> <span class="s1">&#39;Score of Day 1&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;D2_t&#39;</span><span class="p">,</span> <span class="s1">&#39;Sum of weighted scores</span><span class="se">\n\t</span><span class="s1"> of Day 2&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;D2&#39;</span><span class="p">,</span> <span class="s1">&#39;Score of Day 2&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;D3_t&#39;</span><span class="p">,</span> <span class="s1">&#39;Sum of weighted scores</span><span class="se">\n\t</span><span class="s1"> of Day 3&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;D3&#39;</span><span class="p">,</span> <span class="s1">&#39;Score of Day 3&#39;</span><span class="p">)</span>
<span class="c1">#Computation of Scores</span>
<span class="n">FS</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;D1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">P1*f(0)&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;D2_t&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">P1*f(1)&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;P2&#39;</span><span class="p">,</span> <span class="s1">&#39;D2_t&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">P2*f(0)&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;D2_t&#39;</span><span class="p">,</span> <span class="s1">&#39;D2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Divide by num. of articles=2&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;D3_t&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">P1*f(2)&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;P2&#39;</span><span class="p">,</span> <span class="s1">&#39;D3_t&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">P2*f(1)&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;P3&#39;</span><span class="p">,</span> <span class="s1">&#39;D3_t&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">P3*f(0)&#39;</span><span class="p">)</span>
<span class="n">FS</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">&#39;D3_t&#39;</span><span class="p">,</span> <span class="s1">&#39;D3&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Divide by num. of articles=3&#39;</span><span class="p">)</span>

<span class="n">FS</span>
</code></pre></div>

<p><img alt="Figure 5" src="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/images/NextLevelPro_03_05sampledecayflow.png"></p>
<p>To better illustrate, lets consider a simple example:</p>
<div class="highlight"><pre><span></span><code><span class="c1">#define the weights</span>
<span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="nb">round</span><span class="p">(((</span><span class="n">i</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">15</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">)]</span>

<span class="c1">#Sample Scores</span>
<span class="n">score_sample</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<span class="s2">&quot;Day&quot;</span><span class="p">:[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)],</span>
<span class="s2">&quot;Score&quot;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="mi">30</span><span class="p">})</span>

<span class="c1">#add 5 sentinment scores</span>
<span class="n">score_sample</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mf">0.8</span>
<span class="n">score_sample</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mf">0.3</span>
<span class="n">score_sample</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="mf">0.2</span>
<span class="n">score_sample</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">score_sample</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="mf">0.8</span>
<span class="n">score_sample</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>

<p>We defined a function to append new columns for every sentiment value. And the new column would consist of all weighted decay sentiments related to that sentiment value. Then, we compute the mean across each row and get the final score that we would use in the time-series analysis and machine-learning models.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">appendnewcol</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">sentiment</span><span class="p">):</span>
    <span class="n">newcol</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">row</span><span class="o">-</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">sentiment</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">score_sample</span><span class="p">)</span><span class="o">-</span><span class="n">row</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newcol</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">score_sample</span><span class="p">):</span>
        <span class="n">newcol</span><span class="o">=</span><span class="n">newcol</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">score_sample</span><span class="p">)]</span>
    <span class="n">score_sample</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Day</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">newcol</span>
<span class="n">scores</span><span class="o">=</span><span class="n">score_sample</span><span class="p">[</span><span class="s1">&#39;Score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
        <span class="n">appendnewcol</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s1">&#39;Finalscore&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">score_sample</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p><img alt="Figure 6" src="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/images/NextLevelPro_03_06sampledf.png"></p>
<p><em>Note: In the real data, there might be some days that have no articles published. In this case, we would interpolate the date values to ensure the date column is continuous.</em></p>
<div class="highlight"><pre><span></span><code><span class="n">sen</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">sen</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="n">sen</span><span class="o">=</span><span class="n">sen</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">()</span> <span class="c1">#sample interpolation that we used in the real data</span>
</code></pre></div>

<h1>2. Automatic Hyperparameter Optimization</h1>
<p>During the presentation, we illustrated the result of the XGBoost model, but it is well-known that such a decision tree model would require extensive hyperparameter tuning to achieve good results. Therefore, we would like to share the method that we used, which is a package named <code>Optuna</code> (https://github.com/optuna/optuna) for automatic hyperparameter optimization.</p>
<p>Here is a sample code for a binary classifier training with cross-validation, assuming the <code>X</code> <code>y</code> data are loaded in as data frames.</p>
<div class="highlight"><pre><span></span><code><span class="n">RETRAIN_MODEL</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#change to True to retrain</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="c1"># Define hyperparameters to tune</span>
    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;objective&#39;</span><span class="p">:</span><span class="s1">&#39;binary:logistic&#39;</span><span class="p">,</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;reg_alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;reg_alpha&#39;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;reg_lambda&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;reg_lambda&#39;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;colsample_bytree&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;subsample&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="s1">&#39;min_child_weight&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_child_weight&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="c1">#&#39;device&#39; : &quot;cuda&quot;, #use gpu as necessary</span>
        <span class="s1">&#39;tree_method&#39;</span><span class="p">:</span><span class="s2">&quot;hist&quot;</span>
    <span class="p">}</span>

    <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">auc_scores</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">valid_idx</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="n">X_train_fold</span><span class="p">,</span> <span class="n">X_valid_fold</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">valid_idx</span><span class="p">]</span>
        <span class="n">y_train_fold</span><span class="p">,</span> <span class="n">y_valid_fold</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">valid_idx</span><span class="p">]</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_fold</span><span class="p">,</span> <span class="n">y_train_fold</span><span class="p">)</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid_fold</span><span class="p">)</span>
        <span class="n">acc</span><span class="o">=</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_valid_fold</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
        <span class="n">auc_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">auc_scores</span><span class="p">)</span>

<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span><span class="n">study_name</span> <span class="o">=</span> <span class="s2">&quot;xgb_model_training&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">RETRAIN_MODEL</span><span class="p">:</span>
    <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># Adjust the number of trials as necessary</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best trial average AUC: </span><span class="si">{</span><span class="n">study</span><span class="o">.</span><span class="n">best_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Using this package, we can automatically collect the optimized hypermeters instead of performing grid search/alternate optimization manually.</p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2024-03-19T00:00:00+08:00">Tue 19 March 2024</time>
            <h4>Category</h4>
            <a class="category-link" href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/categories.html#progress-report-3-ref">Progress Report 3</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/tags.html#group-next-level-pro-ref">Group Next Level Pro
                    <span class="superscript">1</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/buehlmaier/MFIN7036-student-blog-2024-02" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://buehlmaier.github.io/MFIN7036-student-blog-2024-02/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>